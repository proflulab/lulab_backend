// 登录日志类型枚举
enum LoginLogType {
  USERNAME_PASSWORD // 用户名密码登录
  EMAIL_PASSWORD // 邮箱密码登录
  EMAIL_CODE // 邮箱验证码登录
  PHONE_PASSWORD // 手机密码登录
  PHONE_CODE // 手机验证码登录
}

// 登录日志模型
model LoginLog {
  id         String  @id @default(cuid())
  userId     String? // 用户ID（可为空，登录失败时可能没有用户ID）
  target     String // 登录目标（用户名、邮箱或手机号）
  loginType  String // 登录类型（对应LoginLogType，但数据库中存储为字符串）
  success    Boolean // 是否成功
  ip         String // IP地址
  userAgent  String? // 用户代理
  failReason String? // 失败原因

  // 关联到用户
  user User? @relation(fields: [userId], references: [id], onDelete: SetNull)

  createdAt DateTime @default(now())

  @@index([userId]) // 用户登录日志查询
  @@index([ip, createdAt]) // IP登录记录查询
  @@index([target, createdAt]) // 目标登录记录查询
  @@index([success, createdAt]) // 成功/失败记录查询
}

// 验证码发送限制模型
model CodeSendLimit {
  id         String   @id @default(cuid())
  target     String // 目标（邮箱或手机号）
  ip         String // IP地址
  sendCount  Int      @default(1) // 发送次数
  lastSentAt DateTime @default(now()) // 最后发送时间

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([target, ip]) // 每个目标和IP的组合唯一
  @@index([ip, lastSentAt]) // IP发送记录查询
  @@index([target, lastSentAt]) // 目标发送记录查询
}
