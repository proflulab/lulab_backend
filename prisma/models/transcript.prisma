model Transcript {
  id         String    @id @default(cuid())
  source     String? // 文件名/来源
  rawJson    Json? // 可选：整份原始 JSON 备份
  language   String    @default("zh-CN")
  status     Int       @default(0) @db.SmallInt
  startedAt  DateTime? @map("started_at") @db.Timestamptz(6)
  finishedAt DateTime? @map("finished_at") @db.Timestamptz(6)
  createdAt  DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)

  recordingId String?           @map("recording_id")
  recording   MeetingRecording? @relation(fields: [recordingId], references: [id], onDelete: Cascade)
  summaries   MeetingSummary[]

  paragraphs Paragraph[]

  @@index([createdAt])
  @@index([recordingId])
  @@map("transcripts")
}

model Paragraph {
  id           String @id @default(cuid())
  transcriptId String
  pid          String
  startTimeMs  BigInt
  endTimeMs    BigInt

  speakerId String?
  speaker   PlatformUser? @relation("Speaker", fields: [speakerId], references: [id], onDelete: SetNull)

  transcript Transcript @relation(fields: [transcriptId], references: [id], onDelete: Cascade)

  sentences Sentence[]

  @@unique([transcriptId, pid])
  @@index([transcriptId, startTimeMs])
  @@index([speakerId])
  @@map("paragraphs")
}

model Sentence {
  id          String @id @default(cuid())
  paragraphId String
  sid         String
  startTimeMs BigInt
  endTimeMs   BigInt

  paragraph Paragraph @relation(fields: [paragraphId], references: [id], onDelete: Cascade)
  words     Word[]

  // 可选：冗余一份整句文本，方便全文检索/展示（导入时拼出来）
  text String?

  @@unique([paragraphId, sid])
  @@index([startTimeMs])
}

model Word {
  id          String @id @default(cuid())
  sentenceId  String
  wid         String
  order       Int // 导入时按数组顺序写入
  startTimeMs BigInt
  endTimeMs   BigInt
  text        String

  sentence Sentence @relation(fields: [sentenceId], references: [id], onDelete: Cascade)

  @@unique([sentenceId, wid])
  @@unique([sentenceId, order])
  @@index([text])
  @@map("words")
}
